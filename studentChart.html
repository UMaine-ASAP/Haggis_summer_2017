<!doctype html>
<html>

<head>
	<title>Bar Chart</title>
	<script src="vendor/chart.bundle.js"></script>
	<script src="vendor/utils.js"></script>
	<style>
	canvas {
		-moz-user-select: none;
		-webkit-user-select: none;
		-ms-user-select: none;
	}
	</style>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
</head>

<body>
	<div id="container" style="width: 50%; height: 80vh; margin: 10vh 25%;">
		<canvas id="canvas"></canvas>
	</div>
	<script>
		/*
		Chart.pluginService.register({
			beforeDraw: function(chart) {
				var width = chart.chart.width,
					height = chart.chart.height,
					ctx = chart.chart.ctx;

				ctx.restore();
				var fontSize = (height / 114).toFixed(2);
				ctx.font = fontSize + "em sans-serif";
				ctx.textBaseline = "middle";

				var text = "3.1",
					textX = Math.round((width - ctx.measureText(text).width) / 2),
					textY = height / 2 + ((height / 114) * 11);

				ctx.fillText(text, textX, textY);
				ctx.save();
			}
		});*/

		var loadChart = (opts) => {
			// Destroy leftover data
			if (window.myChart != undefined) {
				window.myChart.destroy();
			}
			
			// Create new chart data
			let data = {
				labels: opts.labels, // These are the categories
				datasets: opts.data
			};
			
			// Add data to the canvas
			let canvas = document.getElementById('canvas');
			let ctx = canvas.getContext('2d');
			window.myChart = new Chart(ctx, {
				type: opts.type,
				data: data,
				options: {
					responsive: true,
					legend: {
						position: 'top',
					},
					title: {
						display: true,
						text: opts.title // replace with actual assignment name
					},
					animation: {
						//animateScale: true,
						animateRotate: true
					},
					elements: (opts.elements || {}),
					scales: (opts.scales || {}),
					maintainAspectRatio: this.maintainAspectRatio, // follows 
				}
			});
		}
		window.onload = function() {
			let color = Chart.helpers.color;
			loadChart({
				type: 'horizontalBar',
				labels: ['Clearity', 'Functionality', 'Features', 'Looks', "Presentation"],
				title: 'Evaluation for Test Assignment',
				data: [{
					label: 'My Average',
					backgroundColor: color(window.chartColors.red).alpha(0.25).rgbString(),
					borderColor: window.chartColors.red,
					borderWidth: 1,
					data: [
						3.8,
						3.1,
						4.2,
						3.7,
						4.5
					]
				}, {
					label: 'Class Average',
					backgroundColor: color(window.chartColors.blue).alpha(0.25).rgbString(),
					borderColor: window.chartColors.blue,
					borderWidth: 1,
					data: [
						3.4,
						3.7,
						3.1,
						3.5,
						3.9
					]
				}],
				scales: {
					xAxes: [{
						ticks: {
							beginAtZero: true,
							max: 5
						}
					}],
					yAxes: [{
						stacked: false
					}]
				}
			});
			
			// Canvas On Click Functionality 
			/**
			* @param {object} evt Event object
			*/
			canvas.addEventListener('click', function(evt) {
				let activePoints = window.myChart.getElementsAtEvent(evt);
				if (activePoints[0]) {
					// Grab data
					let chartData = activePoints[0]['_chart'].config.data;
					let idx = activePoints[0]['_index'];
					// Store variables
					let label = chartData.labels[idx];
					let value = chartData.datasets[0].data[idx];
					// Display data
					let data = "Lable: " + label + "\nValue: " + value;
					//alert(data);
					
					loadChart({
						type: 'horizontalBar',
						labels: ['1', '2', '3', '4', "5"],
						title: 'Scores for ' + label + ' | Overall: ' + value,
						data: [{
							label: 'Students Graded',
							backgroundColor: color(window.chartColors.red).alpha(0.25).rgbString(),
							borderColor: window.chartColors.red,
							borderWidth: 1,
							data: [
								0,
								6,
								17,
								12,
								5
							]
						}, {
							label: 'Your average',
							backgroundColor: color(window.chartColors.blue).alpha(0.25).rgbString(),
							borderColor: window.chartColors.blue,
							data: [
								3.8,
								3.8,
								3.8,
								3.8,
								3.8
							],
							type: 'line'
						}],
						scales: {
							xAxes: [{
								ticks: {
									beginAtZero: true,
									max: 40
								}
							}],
							yAxes: [{
								stacked: false
							}]
						}
					});
				}
			});
		}
	</script>
</body>

</html>